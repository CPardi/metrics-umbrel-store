manifestVersion: 1
id: metrics-bitcoin-wallet-exporter
category: developer
name: "Metrics: Bitcoin Wallet Exporter"
version: "0.1"
tagline: Produce blockchain, wallet and addresses metrics
icon: https://raw.githubusercontent.com/CPardi/metrics-umbrel-store/refs/heads/master/logos/metrics-bitcoin-wallet-exporter.svg
description: >-
  Produce blockchain, wallet and addresses metrics. Most relevant metrics are:
  
    - wallet total balance
    - wallet version
    - if the wallet is unlocked
    - available (spendable) balance for each managed addresses (and watched addresses)
    - best block time and index
  
  ⚠️ This application requires additional setup to add a watch only wallet to the Bitcoin Node. Instructions for Bitcoin Core are given below. 


  SSH into the Bitcoin Core container, this can be done in the UI by going to "Settings" -> "Advanced settings" -> "Terminal" -> "Bitcoin Node". Use the command below to create a new watch only wallet with no private keys called "metrics-bitcoin-wallet-exporter".


  ```
  bitcoin-cli createwallet "metrics-bitcoin-wallet-exporter" true
  ```


  ## Monitoring Balances

  This exporter can optionally output addresses and balances. To define what to watch, descriptors need to be imported into Bitcoin Core. Descriptors can define addresses or a wallet's public keys. More information about the different types of descriptor can be found in the [documentation](https://bitcoincoredocs.com/descriptors.html).
  
  
  ⚠️ Bitcoin Core stores imported addresses and wallets un-encrypted on the machine it is running on.
  
  ### Importing an Address
  
  To create a descriptor for a single signature address the following procedure can be used. Firstly, replace `<ADDR>` with an address in the command below and run to calculate a checksum.


  ```
  bitcoin-cli getdescriptorinfo "addr(<ADDR>)"
  ```


  Next, copy the checksum `<CHECKSUM>` and replace this and `<ADDR>` in the command below and run.  

  
  ```
  bitcoin-cli -rpcwallet="metrics-bitcoin-wallet-exporter" importdescriptors "[{ \"desc\": \"<ADDR>#<CHECKSUM>\", \"timestamp\": \"now\", \"label\": \"Address 1\"}]"
  ```

  ### Importing a Wallet
  
  Descriptors for wallet public keys are more complex to construct, as they may require derivation paths to be specified. However, [Sparrow Wallet](https://www.sparrowwallet.com) can export descriptors by going to "Settings" -> "Export" -> "Output Descriptor" -> "Export File". Inside the exported file will be descriptors for receive and change addresses. The command below can then be used to import the descriptor. 

  
  ```
  bitcoin-cli -rpcwallet="metrics-bitcoin-wallet-exporter" importdescriptors "[{ \"desc\": \"<DESCRIPTOR>\", \"timestamp\": \"now\", \"label\": \"Wallet 1\"}]"
  ```

  ### Rescan Blockchain
  
  The import commands above will not rescan the blockchain and so will only show balances from transactions made after the time the descriptor was first added. To include any historical balances, replace `<BLOCK HEIGHT>` in the command below and run to rescan the whole blockchain. 
  

  ```
  bitcoin-cli -rpcwallet="metrics-bitcoin-wallet-exporter" rescanblockchain <BLOCK HEIGHT>
  ```

  
  If `<BLOCK HEIGHT>` is unknown, then `0` can be used to rescan the whole blockchain. However, this may take a while to complete.

  ### Confirming Imports
  
  Any imported descriptors should then be visible in the list generated by


  ```
  bitcoin-cli -rpcwallet="metrics-bitcoin-wallet-exporter" listdescriptors
  ```  

  ### Removing Imports

  Once descriptors have been imported they cannot be removed. If you wish to stop watching an address or wallet, then the "metrics-bitcoin-wallet-exporter" wallet should be removed. This can be done with the following commands.  


  ```
  bitcoin-cli unloadwallet "metrics-bitcoin-wallet-exporter"
  rm -rf "/data/.bitcoin/metrics-bitcoin-wallet-exporter/"
  ```

developer: lepetitbloc
website: https://github.com/LePetitBloc
dependencies:
  - bitcoin
repo: https://github.com/LePetitBloc/bitcoind-exporter
support: https://github.com/CPardi/metrics-umbrel-store/issues
port: 9103
gallery:
  - https://raw.githubusercontent.com/CPardi/metrics-umbrel-store/refs/heads/master/screenshots/metrics-bitcoin-wallet-exporter/1.jpg
path: "metrics"
defaultUsername: ""
defaultPassword: ""
submitter: CPardi
submission: https://github.com/CPardi/metrics-umbrel-store/pull/17
